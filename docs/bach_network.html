<!DOCTYPE html>
<html lang="en">

<head>
  <title>Bach Network</title>
  <meta charset="utf-8">
  <script src="graphology.min.js"></script>
  <script>
    //const graph = new graphology.Graph();
    const { UndirectedGraph, DirectedGraph } = graphology;
  </script>
  <script src="graphology-library.min.js"></script>
  <script>
    //const density = graphologyLibrary.metrics.graph.density(graph);
  </script>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="graph_data.js"></script>
  <style type="text/css">
    #container {
      width: 90%;
      height: 90vh;
    }

    #text {
      margin: 10px;
    }

    #buttons {
      width: auto;
      margin-bottom: 3px;
      padding-left: 3px;
      padding-right: 3px;
      padding-top: 3px;
      padding-bottom: 3px;
      border: 1px solid lightgray;
      text-align: right;
    }

    #mynetwork {
      width: auto;
      height: 80%;
      border: 1px solid lightgray;
    }

    .button {
      width: 6rem;
      height: 1.8rem;
    }

    #selectedNode {
      width: 20em;
      margin-right: 2px;
      display:inline-block
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="text">
      <h1>Bach Nework</h1>
      <p>Click to select a node. Double click to open Wikipedia.</p>
    </div>
    <div id="buttons">
      <label id="selectedNode" for="neighbors"></label>
      <button class="button" type="button" name="neighbors" onclick="showNeighbors()">Neighbors</button>
      <button class="button" type="button" onclick="reset()">Reset</button>
    </div>
    <div id="mynetwork"></div>
  </div>
  <script>
    selectedNode = null;

    const setSelectedNode = (text) => {
      selectedNode = text;
      p = document.getElementById("selectedNode");
      if (text === null) {
        p.innerText = `...`;
      } else {
        p.innerText = `${selectedNode}`;
      }
    }

    const showNeighbors = () => {
      console.log(`selectedNode: ${selectedNode}`);
      if (selectedNode !== null) {
        neighbors = graph.neighbors(selectedNode);
        neighbors.push(selectedNode);
        const sub = graphologyLibrary.operators.subgraph(graph, neighbors);
        createVisNetwork(sub);
      }
    }

    const reset = () => {
      setSelectedNode(null);
      data = { nodes: nodes, edges: edges };
      const graph = UndirectedGraph.from(data);
      createVisNetwork(graph);  
    }


  </script>

  <script>

    // graphology instance
    data = { nodes: nodes, edges: edges };
    const graph = UndirectedGraph.from(data);
    //const sub = graphologyLibrary.operators.subgraph(graph, ['Handel', 'Johann Sebastian Bach']);
    // Some procedures with graphology.js
    // ...
    // ...


    //console.log(node_list);
    //console.log(edge_list);

    // vis.js

    const createVisNetwork = graph => {

      // graphology.js to vis.js
      const node_list = graph.mapNodes((node, attr) => {
        return { id: node, label: node, value: attr.value };
      });

      const edge_list = graph.mapEdges((edge, attr, source, target) => {
        return { from: source, to: target, value: attr.value };
      });

      var nodes = new vis.DataSet(node_list);
      var edges = new vis.DataSet(edge_list);

      var container = document.getElementById('mynetwork');

      var data = {
        nodes: nodes,
        edges: edges
      };

      var options = {
        nodes: {
          shape: "dot",
          scaling: {
            customScalingFunction: function (min, max, total, value) {
              return value / total;
            },
            min: 7,
            max: 70,
          },
        },
      };

      var network = new vis.Network(container, data, options);

      network.on('click', properties => {
        text = properties.nodes[0];
        if (text !== undefined) {
          setSelectedNode(text);
        }
      });

      network.on('doubleClick', properties => {
        var nodeId = properties.nodes[0];
        // alert(properties.nodes[0]);

        node = network.body.nodes[nodeId];
        node.setOptions({
          font: {
            size: 20,
            color: "#ff7f50"
          },
          color: {
            highlight: "#ff7f50",
            background: "#ff8f70"
          }
        });

        var url = 'https://en.wikipedia.org/wiki/' + nodeId
        window.open(url, '_blank').focus();
      });
    }

    createVisNetwork(graph);
    setSelectedNode(null);
  </script>
</body>

</html>