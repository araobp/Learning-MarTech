<!DOCTYPE html>
<html lang="en">

<head>
  <title>Bach Network</title>
  <meta charset="utf-8">
  <script src="graphology.min.js"></script>
  <script>
    //const graph = new graphology.Graph();
    const { UndirectedGraph, DirectedGraph } = graphology;
  </script>
  <script src="graphology-library.min.js"></script>
  <script>
    //const density = graphologyLibrary.metrics.graph.density(graph);
  </script>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="graph_data.js"></script>
  <style type="text/css">
    #container {
      width: 90%;
      height: 90vh;
    }

    #text {
      margin: 10px;
    }

    #buttons {
      margin: 5px;
    }

    #mynetwork {
      width: 100%;
      height: 80%;
      border: 1px solid lightgray;
    }

    .button {
      width: 6rem;
      height: 1.8rem;
      margin: 3px;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="text">
      <h1>Bach Nework</h1>
      <p>Click to select a node. Double click to open Wikipedia.</p>
    </div>
    <div id="buttons">
      <button class="button" type="button" onclick="showNeighbors()">Neighbors</button>
      <button class="button" type="button" onclick="reset()">Reset</button>
    </div>
    <div id="mynetwork"></div>
  </div>
  <script>
    currentNode = null;

    const showNeighbors = () => {
      console.log(`currentNode: ${currentNode}`);
      if (currentNode !== null) {
        const node_list_neighbors = graph.mapNeighbors(currentNode, (node, attr) => {
          return { key: node, attributes: { value: attr.value } };
        });
        attr = graph.getNodeAttributes(currentNode);
        node_list_neighbors.push({key: currentNode, attributes: attr});

        console.log(node_list_neighbors);
        const edge_list_neighbors = graph.mapEdges(currentNode, (edge, attr, source, target) => {
          return { key: edge, source: source, target: target, attributes: { value: attr.value } };
        });
        console.log(edge_list_neighbors);
        data = { nodes: node_list_neighbors, edges: edge_list_neighbors };
        const graphNeighbors = UndirectedGraph.from(data);
        createVisNetwork(graphNeighbors);
      }
    }

    const reset = () => {
      currentNode = null;
      data = { nodes: nodes, edges: edges };
      const graph = UndirectedGraph.from(data);
      createVisNetwork(graph);  
    }

  </script>

  <script>

    // graphology instance
    data = { nodes: nodes, edges: edges };
    const graph = UndirectedGraph.from(data);

    // Some procedures with graphology.js
    // ...
    // ...


    //console.log(node_list);
    //console.log(edge_list);

    // vis.js

    const createVisNetwork = graph => {

      // graphology.js to vis.js
      const node_list = graph.mapNodes((node, attr) => {
        return { id: node, label: node, value: attr.value };
      });

      const edge_list = graph.mapEdges((edge, attr, source, target) => {
        return { from: source, to: target, value: attr.value };
      });

      var nodes = new vis.DataSet(node_list);
      var edges = new vis.DataSet(edge_list);

      var container = document.getElementById('mynetwork');

      var data = {
        nodes: nodes,
        edges: edges
      };

      var options = {
        nodes: {
          shape: "dot",
          scaling: {
            customScalingFunction: function (min, max, total, value) {
              return 2 * value / total;
            },
            min: 7,
            max: 70,
          },
        },
      };

      var network = new vis.Network(container, data, options);

      network.on('click', properties => {
        currentNode = properties.nodes[0];
      });

      network.on('doubleClick', properties => {
        var nodeId = properties.nodes[0];
        // alert(properties.nodes[0]);

        node = network.body.nodes[nodeId];
        node.setOptions({
          font: {
            size: 20,
            color: "#ff7f50"
          },
          color: {
            highlight: "#ff7f50",
            background: "#ff8f70"
          }
        });

        var url = 'https://en.wikipedia.org/wiki/' + nodeId
        window.open(url, '_blank').focus();
      });
    }

    createVisNetwork(graph);
  </script>
</body>

</html>